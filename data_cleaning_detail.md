# `customer_data.csv` 資料清洗流程詳解

本文檔詳細說明了對 `customer_data.csv` 檔案執行的資料清洗流程。該流程通過 `data_cleaning.py` 指令碼實現，旨在解決資料中的各種問題，包括格式錯誤、缺失值、不一致的資料以及異常值，從而產生一個乾淨、可用於分析的資料集 `cleaned_customer_data.csv`。

---

## 總覽

- **輸入檔案:** `customer_data.csv`
- **輸出檔案:** `cleaned_customer_data.csv`
- **執行腳本:** `data_cleaning.py`

**清洗目標:**
1.  處理檔案讀取時的編碼問題。
2.  標準化欄位名稱。
3.  移除重複的資料記錄。
4.  處理數值與類別型欄位的缺失值。
5.  修正不合理的數值（如負數費用）。
6.  確保資料的完整性與一致性。

---

## 清洗步驟詳解

### 第 1 步：讀取與初步整理

1.  **讀取資料 (處理編碼問題):**
    -   使用 `pandas` 的 `read_csv` 函式讀取 `customer_data.csv`。
    -   由於原始檔案可能包含繁體中文，明確指定使用 `big5` 編碼進行讀取，以避免亂碼。
    -   *日誌輸出: `成功讀取資料 (Big5 編碼)`*

2.  **清理欄位名稱:**
    -   部分欄位名稱前後可能存在多餘的空白字元，這會導致後續處理困難。
    -   移除所有欄位名稱字串的前後空白。
    -   *日誌輸出: `已清理欄位名稱空白`*

3.  **移除重複資料:**
    -   檢查並刪除完全重複的資料列，以確保每筆記錄的唯一性。
    -   *日誌輸出: `移除重複資料: 0 筆` (在此次執行中未發現重複資料)*

### 第 2 步：數值型欄位處理

此步驟專門處理與數字相關的欄位，確保其格式正確且數值合理。

1.  **處理 `總費用` 欄位:**
    -   **問題:** 此欄位應為數值，但可能包含非數字字元（如空字串或符號），導致其被識別為物件類型。
    -   **操作:**
        -   使用 `pd.to_numeric` 將其強制轉換為數值格式。
        -   `errors='coerce'` 參數會將任何無法轉換的值變為 `NaN` (Not a Number)。
        -   最後，使用 `.fillna(0)` 將所有 `NaN` 值替換為 0，這通常表示客戶是新客戶，尚未產生總費用。
    -   *日誌輸出: `已處理 '總費用' 欄位 (修正 20 筆非數值資料)`*

2.  **填補服務使用量缺失值:**
    -   **欄位:** `平均長途話費`, `平均下載量( GB)`
    -   **問題:** 部分客戶在這些欄位的值為 `NaN`。
    -   **假設:** 缺失值代表該客戶未使用對應的服務。
    -   **操作:** 將這兩個欄位的 `NaN` 值填補為 `0`。
    -   *日誌輸出:*
        -   `'平均長途話費': 填補 680 個缺失值為 0`
        -   `'平均下載量( GB)': 填補 680 個缺失值為 0`

3.  **檢查並修正費用欄位負值:**
    -   **問題:** 費用、退款、收入等欄位理論上不應為負數。腳本檢查了多個費用相關欄位。
    -   **操作:**
        -   識別出 `每月費用` 和 `總退款` 欄位中存在負值。
        -   將這些負值重新設定為 `0`。
        -   `總收入` 欄位因其依賴其他費用欄位，在下一步驟中重新計算。
    -   *日誌輸出:*
        -   `'總費用' (累積總支出): 無負值`
        -   `'每月費用' (目前每月費用): 發現 12 筆負值 (範圍: -10.00 ~ -2.00)，已修正為 0`
        -   `'額外數據費用' (額外數據收費): 無負值`
        -   `'額外長途費用' (額外長途收費): 無負值`
        -   `'總退款' (退款總額): 發現 1 筆負值 (範圍: -8.00 ~ -8.00)，已修正為 0`

4.  **重新計算 `總收入`:**
    -   **原因:** 由於 `總費用` 和 `總退款` 等基礎費用欄位的值已被修正，依賴它們計算的 `總收入` 也必須重新計算以確保資料一致性。
    -   **公式:** `總收入 = 總費用 - 總退款 + 額外數據費用 + 額外長途費用`
    -   **操作:** 根據以上公式更新整個 `總收入` 欄位。
    -   *日誌輸出: `總收入已重新計算，修正筆數: 31`*

5.  **最終驗證:**
    -   在修正和重新計算後，再次檢查所有費用欄位，確保已無負值存在。
    -   *日誌輸出: `所有費用欄位驗證通過!`*

6.  **檢查 `年齡` 範圍:**
    -   檢查年齡是否在合理範圍內（腳本設定為 18-100 歲）。
    -   *日誌輸出: `年齡範圍正常 (19-80歲)`*

### 第 3 步：類別型欄位處理

1.  **填補服務相關欄位的缺失值:**
    -   **欄位:** `網路連線類型`, `線上安全服務`, `線上備份服務`, `設備保護計劃`, `技術支援計劃`, `電視節目`, `電影節目`, `音樂節目`, `無限資料下載`, `多線路服務`。
    -   **問題:** 這些欄位的缺失值 `NaN` 代表客戶未訂閱該服務。
    -   **操作:** 將 `NaN` 替換為 `'None'` 字串，使其意義更加明確。
    -   *日誌輸出: `已填補 10 個服務欄位的缺失值為 'None'`*

2.  **處理 `優惠方式` 缺失值:**
    -   **問題:** `優惠方式` 欄位有大量缺失值。
    -   **假設:** 缺失代表該客戶未使用任何優惠方案。
    -   **操作:** 將 `NaN` 替換為 `'無優惠'`。
    -   *日誌輸出: `'優惠方式': 填補 3877 個缺失值為 '無優惠'`*

3.  **處理 `客戶流失` 相關欄位:**
    -   **欄位:** `客戶流失類別`, `客戶離開原因`。
    -   **邏輯:** 這兩個欄位的資訊僅對已流失的客戶有意義。對於未流失的客戶，這些欄位為 `NaN` 是正常現象。
    -   **操作:** 保留這些欄位的缺失值，不進行填補。

### 第 4 步：最終品質檢查與輸出

1.  **檢查剩餘缺失值:**
    -   再次掃描整個資料集，確認除了 `客戶流失類別` 和 `客戶離開原因` 外，是否還有其他欄位存在缺失值。
    -   *日誌輸出:*
        -   `客戶流失類別: 5174 個缺失值 (73.5%)`
        -   `客戶離開原因: 5174 個缺失值 (73.5%)`

2.  **輸出清洗後的資料:**
    -   將清洗完成的 `DataFrame` 儲存為 `cleaned_customer_data.csv`。
    -   使用 `utf-8-sig` 編碼，以確保在 Excel 等軟體中打開時，繁體中文能正確顯示。
    -   *日誌輸出:*
        -   `檔案已儲存: 'cleaned_customer_data.csv'`
        -   `清洗後資料: 7043 筆, 38 個欄位`
        -   `資料完整性: 98.07%`

---

## 結論

經過上述清洗流程，原始資料中的格式錯誤、異常值和大部分缺失值都得到了妥善處理。產出的 `cleaned_customer_data.csv` 是一個結構清晰、資料一致的乾淨資料集，可直接用於後續的探索性資料分析、視覺化和模型建立。
