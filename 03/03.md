# é¡§å®¢ç‹€æ…‹åˆ†æèˆ‡æµå¤±åŸå› ï¼šPython ç¨‹å¼ç¢¼è©³è§£

æœ¬æ–‡ä»¶è©³ç´°æ‹†è§£äº†ä½¿ç”¨ Python (`pandas`, `matplotlib`, `seaborn`) é€²è¡Œé¡§å®¢æµå¤±åˆ†æçš„å®Œæ•´æµç¨‹ã€‚é€™ä»½åˆ†æé‡å°é¡§å®¢çš„ä¸‰ç¨®ç‹€æ…‹ï¼ˆStayed, Churned, Joinedï¼‰é€²è¡Œç‰¹å¾µæ¯”è¼ƒï¼Œä¸¦æ·±å…¥æ¢è¨å·²æµå¤±å®¢ç¾¤çš„å…·é«”åŸå› ã€‚

---

## æ­¥é©Ÿ 1ï¼šç’°å¢ƒè¨­å®šèˆ‡è§£æ±ºä¸­æ–‡äº‚ç¢¼

é€™ä¸€æ®µæ˜¯è¦–è¦ºåŒ–çš„åŸºç¤ã€‚Python çš„ç¹ªåœ–å¥—ä»¶é è¨­ä¸æ”¯æ´ä¸­æ–‡å­—å…ƒï¼Œå¦‚æœä¸è¨­å®šï¼Œåœ–è¡¨ä¸Šçš„ä¸­æ–‡æœƒè®Šæˆæ–¹æ¡†ï¼ˆâ–¡â–¡ï¼‰ã€‚

```python
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
import platform

# --- è¨­å®šç¹ªåœ–é¢¨æ ¼ ---
sns.set(style="whitegrid")  # è¨­å®šèƒŒæ™¯ç‚ºç™½è‰²ç¶²æ ¼ï¼Œè®“æ•¸æ“šæ›´æ˜“è®€

# --- è¨­å®šä¸­æ–‡å­—å‹ (é—œéµæ­¥é©Ÿ) ---
# åµæ¸¬ä½œæ¥­ç³»çµ±ï¼Œè‡ªå‹•é¸æ“‡åˆé©çš„ä¸­æ–‡å­—å‹
system_name = platform.system()
if system_name == 'Windows':
    plt.rcParams['font.sans-serif'] = ['Microsoft JhengHei']  # Windows ä½¿ç”¨å¾®è»Ÿæ­£é»‘é«”
elif system_name == 'Darwin': # Mac
    plt.rcParams['font.sans-serif'] = ['Arial Unicode MS']    # Mac ä½¿ç”¨é€šç”¨å­—å‹
else:
    plt.rcParams['font.sans-serif'] = ['SimHei']              # Linux å¸¸è¦‹å­—å‹

plt.rcParams['axes.unicode_minus'] = False # è®“è² è™Ÿ (-) èƒ½å¤ æ­£å¸¸é¡¯ç¤ºï¼Œä¸æœƒè®Šæˆæ–¹æ¡†
ğŸ’¡ ç¨‹å¼ç¢¼è§£æ
Libraries: åŒ¯å…¥ pandas åšæ•¸æ“šè™•ç†ï¼Œmatplotlib å’Œ seaborn åšè¦–è¦ºåŒ–ç¹ªåœ–ã€‚

platform.system(): è‡ªå‹•åµæ¸¬ä½¿ç”¨è€…æ˜¯åœ¨ Windows é‚„æ˜¯ Mac ç’°å¢ƒï¼Œä¸¦æ“šæ­¤é¸æ“‡æ­£ç¢ºçš„ç³»çµ±å­—å‹ï¼Œç¢ºä¿ç¨‹å¼ç¢¼çš„å¯æ”œæ€§ã€‚

axes.unicode_minus: åœ¨çµ±è¨ˆåœ–è¡¨ä¸­ï¼Œè² æ•¸å¾ˆå¸¸è¦‹ï¼Œé€™è¡ŒæŒ‡ä»¤ç¢ºä¿è² è™Ÿä¸æœƒå› ç‚ºå­—å‹å•é¡Œé¡¯ç¤ºéŒ¯èª¤ã€‚

æ­¥é©Ÿ 2ï¼šè®€å–è³‡æ–™
ç°¡å–®ä½†æœ€é‡è¦çš„ä¸€æ­¥ï¼Œå°‡ CSV æª”æ¡ˆè¼‰å…¥åˆ°è¨˜æ†¶é«”ä¸­ã€‚

Python

# 1. è®€å–è³‡æ–™
# è«‹ç¢ºä¿ CSV æª”æ¡ˆè·¯å¾‘æ­£ç¢º
df = pd.read_csv('customer_data_cleaned.csv')

# å»ºè­°ï¼šå¯ä»¥åœ¨æ­¤è™•åŠ å…¥ print(df.head()) ä¾†é è¦½è³‡æ–™æ˜¯å¦æ­£ç¢ºè¼‰å…¥
# print(df.columns) 
ğŸ’¡ ç¨‹å¼ç¢¼è§£æ
pd.read_csv: å°‡ CSV æª”æ¡ˆè®€å–ä¸¦è½‰æ›ç‚º Pandas DataFrame (è®Šæ•¸ df)ã€‚

è·¯å¾‘æ³¨æ„: ç¨‹å¼ç¢¼é è¨­æª”æ¡ˆèˆ‡è…³æœ¬åœ¨åŒä¸€ç›®éŒ„ã€‚è‹¥æª”æ¡ˆåœ¨ä¸åŒä½ç½®ï¼Œéœ€ä¿®æ”¹ç‚ºçµ•å°è·¯å¾‘ï¼ˆå¦‚ C:/Data/file.csvï¼‰ã€‚

æ­¥é©Ÿ 3ï¼š(a) æ‰¾å‡ºç¾¤çµ„é‡è¦ç‰¹å¾µ - æ•¸å€¼è®Šæ•¸æ¯”è¼ƒ
æˆ‘å€‘æ¯”è¼ƒ Stayed, Churned, Joined ä¸‰ç¾¤äººåœ¨ã€Œè²»ç”¨ã€ã€ã€Œå¹´é½¡ã€ç­‰æ•¸å€¼ä¸Šçš„å·®ç•°ã€‚

Python

# --- å®šç¾©è¦åˆ†æçš„æ•¸å€¼æ¬„ä½ ---
numeric_cols = ['åŠ å…¥æœŸé–“ (æœˆ)', 'æ¯æœˆè²»ç”¨', 'ç¸½è²»ç”¨', 'å¹´é½¡', 'ç¸½æ”¶å…¥']

# --- è³‡æ–™è½‰ç½® (Melt) ---
# å°‡ã€Œå¯¬è¡¨æ ¼ã€è½‰ç‚ºã€Œé•·è¡¨æ ¼ã€ï¼Œé€™æ˜¯ç‚ºäº†é…åˆ Seaborn çš„ç¹ªåœ–é‚è¼¯
df_numeric_melted = df.melt(id_vars='å®¢æˆ¶ç‹€æ…‹', 
                            value_vars=numeric_cols, 
                            var_name='ç‰¹å¾µ', 
                            value_name='æ•¸å€¼')

# --- ç¹ªåœ– ---
print("æ­£åœ¨ç¹ªè£½æ•¸å€¼ç‰¹å¾µæ¯”è¼ƒåœ–...")
plt.figure(figsize=(15, 6))
# ç¹ªè£½åˆ†çµ„é•·æ¢åœ–
sns.barplot(data=df_numeric_melted, 
            x='ç‰¹å¾µ', 
            y='æ•¸å€¼', 
            hue='å®¢æˆ¶ç‹€æ…‹',     # æ ¹æ“šå®¢æˆ¶ç‹€æ…‹ä¸Šä¸åŒçš„é¡è‰²
            errorbar=None,     # ä¸é¡¯ç¤ºèª¤å·®ç·š (è®“åœ–é¢æ›´ä¹¾æ·¨)
            palette='viridis') # è¨­å®šé…è‰²

plt.title('å„ç¾¤çµ„æ•¸å€¼ç‰¹å¾µå¹³å‡å€¼æ¯”è¼ƒ', fontsize=16)
plt.legend(title='å®¢æˆ¶ç‹€æ…‹')
plt.show()
ğŸ’¡ ç¨‹å¼ç¢¼è§£æ
ç‚ºä»€éº¼è¦ç”¨ meltï¼Ÿ: åŸå§‹è³‡æ–™æ˜¯ä¸€åˆ—ä»£è¡¨ä¸€å€‹å®¢æˆ¶ï¼ˆå¯¬è¡¨æ ¼ï¼‰ã€‚ç‚ºäº†ä¸€æ¬¡ç•«å‡º 5 å€‹ç‰¹å¾µçš„æ¯”è¼ƒåœ–ï¼Œæˆ‘å€‘ç”¨ melt æŠŠè³‡æ–™ã€Œæ‹‰é•·ã€ï¼Œæ–¹ä¾¿ seaborn è‡ªå‹•åˆ†çµ„ã€‚

hue='å®¢æˆ¶ç‹€æ…‹': é€™æ˜¯è¦–è¦ºåŒ–çš„æ ¸å¿ƒã€‚å®ƒå‘Šè¨´ç¨‹å¼ï¼šã€Œå°æ–¼æ¯ä¸€å€‹ç‰¹å¾µï¼ˆXè»¸ï¼‰ï¼Œè«‹å¹«æˆ‘æ‹†æˆä¸‰æ ¹æŸ±å­ï¼ˆStayed, Churned, Joinedï¼‰ä¸¦ç”¨ä¸åŒé¡è‰²å€åˆ†ã€ã€‚

æ­¥é©Ÿ 4ï¼š(a) æ‰¾å‡ºç¾¤çµ„é‡è¦ç‰¹å¾µ - é¡åˆ¥è®Šæ•¸åˆ†å¸ƒ
åˆ†æã€Œåˆç´„ã€ã€ã€Œç¶²è·¯é¡å‹ã€ç­‰æ–‡å­—å‹è³‡æ–™ã€‚æˆ‘å€‘æƒ³çœ‹æ¯ä¸€ç¨®ç‹€æ…‹ä¸‹ï¼Œå„é¡åˆ¥çš„ç™¾åˆ†æ¯”çµæ§‹ã€‚

Python

print("æ­£åœ¨ç¹ªè£½é¡åˆ¥ç‰¹å¾µåˆ†å¸ƒåœ–...")
categorical_cols = ['åˆç´„é¡å‹', 'ç¶²è·¯é€£ç·šé¡å‹', 'å„ªæƒ æ–¹å¼']

# ä½¿ç”¨è¿´åœˆï¼Œä¸€æ¬¡è™•ç†ä¸€å€‹æ¬„ä½
for col in categorical_cols:
    # 1. è¨ˆç®—ç™¾åˆ†æ¯”äº¤å‰è¡¨
    # normalize='index' è¡¨ç¤ºå°‡æ¯ä¸€åˆ— (Stayed/Churned...) çš„ç¸½å’Œè¨­ç‚º 1 (å³ 100%)
    cross_tab = pd.crosstab(df['å®¢æˆ¶ç‹€æ…‹'], df[col], normalize='index') * 100
    
    # 2. ç¹ªè£½å †ç–Šé•·æ¢åœ– (stacked=True)
    ax = cross_tab.plot(kind='bar', stacked=True, figsize=(10, 6), colormap='Set2')
    
    plt.title(f'{col} åœ¨å„å®¢æˆ¶ç‹€æ…‹çš„åˆ†å¸ƒ (%)', fontsize=16)
    plt.ylabel('ç™¾åˆ†æ¯” (%)')
    plt.xlabel('å®¢æˆ¶ç‹€æ…‹')
    plt.xticks(rotation=0) # è®“ X è»¸çš„æ–‡å­—è½‰æ­£ï¼Œä¸è¦æ­ªæ–œ
    
    # æŠŠåœ–ä¾‹ (Legend) ç§»åˆ°åœ–è¡¨å¤–é¢ï¼Œé¿å…æ“‹ä½åœ–å½¢
    plt.legend(title=col, bbox_to_anchor=(1.05, 1), loc='upper left') 
    
    # 3. åœ¨é•·æ¢åœ–ä¸Šæ¨™ç¤ºå…·é«”æ•¸å­—
    for c in ax.containers:
        # fmt='%.1f%%' è¡¨ç¤ºå–å°æ•¸é»å¾Œä¸€ä½ä¸¦åŠ ä¸Š %
        ax.bar_label(c, fmt='%.1f%%', label_type='center', fontsize=10, color='white')
        
    plt.tight_layout() # è‡ªå‹•èª¿æ•´ç‰ˆé¢é–“è·
    plt.show()
ğŸ’¡ ç¨‹å¼ç¢¼è§£æ
pd.crosstab(..., normalize='index'): é€™æ˜¯çµ±è¨ˆåˆ†æçš„ç¥å™¨ã€‚å®ƒä¸åªç®—äººæ•¸ï¼Œé‚„ç›´æ¥å¹«ä½ ç®—æˆã€Œä½”è©²ç¾¤çµ„çš„ç™¾åˆ†æ¯”ã€ã€‚é€™èƒ½é¿å…å› ç‚ºç¾¤çµ„äººæ•¸å¤šå¯¡ä¸åŒè€Œé€ æˆçš„è¦–è¦ºèª¤å°ã€‚

stacked=True: ä½¿ç”¨å †ç–Šé•·æ¢åœ–ï¼Œå¯ä»¥æ¸…æ¥šçœ‹åˆ°åœ¨æ¯ä¸€å€‹ç¾¤çµ„å…§éƒ¨ï¼Œä¸åŒåˆç´„é¡å‹çš„ä½”æ¯”ç¸½å’Œç‚º 100%ã€‚

ax.bar_label: è‡ªå‹•å°‡ç®—å¥½çš„ç™¾åˆ†æ¯”æ•¸å­—æ¨™è¨»åœ¨åœ–è¡¨å€å¡Šä¸­å¤®ï¼Œæ–¹ä¾¿é–±è®€ã€‚

æ­¥é©Ÿ 5ï¼š(b) é‡å°å·²æµå¤±å®¢ç¾¤ - åˆ†ææµå¤±å¤§é¡åˆ¥
æ¥ä¸‹ä¾†åªé–å®š Churned (å·²æµå¤±) çš„äººã€‚é¦–å…ˆçœ‹å¤§æ–¹å‘çš„æµå¤±æ­¸é¡ï¼ˆä¾‹å¦‚ï¼šæ˜¯å› ç‚ºç«¶çˆ­å°æ‰‹ã€æœå‹™æ…‹åº¦é‚„æ˜¯åƒ¹æ ¼ï¼‰ã€‚

Python

print("æ­£åœ¨ç¹ªè£½æµå¤±é¡åˆ¥åœ–...")
# å…ˆç¯©é¸å‡ºå·²æµå¤±çš„è³‡æ–™
churned_df = df[df['å®¢æˆ¶ç‹€æ…‹'] == 'Churned']

# è¨ˆç®—å„æµå¤±é¡åˆ¥çš„æ•¸é‡
churn_category_counts = churned_df['å®¢æˆ¶æµå¤±é¡åˆ¥'].value_counts()

# ç¹ªè£½åœ“é¤…åœ–
plt.figure(figsize=(8, 8))
plt.pie(churn_category_counts, 
        labels=churn_category_counts.index, 
        autopct='%1.1f%%',   # é¡¯ç¤ºç™¾åˆ†æ¯”
        startangle=140,      # æ—‹è½‰èµ·å§‹è§’åº¦ï¼Œç´”ç²¹ç‚ºäº†ç¾è§€
        colors=sns.color_palette("pastel")) # ä½¿ç”¨æŸ”å’Œè‰²ç³»
plt.title('å®¢æˆ¶æµå¤±é¡åˆ¥ä½”æ¯”', fontsize=16)
plt.show()
ğŸ’¡ ç¨‹å¼ç¢¼è§£æ
è³‡æ–™ç¯©é¸: df[df['å®¢æˆ¶ç‹€æ…‹'] == 'Churned'] å‰µé€ äº†ä¸€å€‹æ–°çš„ DataFrameï¼Œè£¡é¢æ’é™¤æ‰äº†é‚„åœ¨çš„å®¢æˆ¶ï¼Œè®“å¾ŒçºŒåˆ†ææ›´ç²¾æº–ã€‚

value_counts(): å¿«é€Ÿè¨ˆç®—æ¯å€‹é¡åˆ¥çš„å‡ºç¾æ¬¡æ•¸ã€‚

åœ“é¤…åœ–: é©åˆç”¨ä¾†å‘ˆç¾ã€Œæ•´é«”ä¸­çš„çµ„æˆçµæ§‹ã€ã€‚

æ­¥é©Ÿ 6ï¼š(b) é‡å°å·²æµå¤±å®¢ç¾¤ - æ’åé›¢é–‹åŸå› 
æœ€å¾Œï¼Œæˆ‘å€‘è¦çœ‹å…·é«”çš„ã€Œé›¢é–‹åŸå› ã€ï¼Œå› ç‚ºåŸå› å¯èƒ½å¾ˆå¤šï¼Œæˆ‘å€‘åªå–å‰ 10 åä¾†åˆ†æã€‚

Python

print("æ­£åœ¨ç¹ªè£½é›¢é–‹åŸå› åœ–...")
# å–å‰ 10 åé›¢é–‹åŸå› 
top_churn_reasons = churned_df['å®¢æˆ¶é›¢é–‹åŸå› '].value_counts().head(10)

plt.figure(figsize=(12, 8))
# ç¹ªè£½æ°´å¹³é•·æ¢åœ– (æ³¨æ„é€™è£¡æ˜¯æŠŠæ•¸å€¼æ”¾ X è»¸ï¼ŒåŸå› æ”¾ Y è»¸)
sns.barplot(x=top_churn_reasons.values, 
            y=top_churn_reasons.index, 
            palette='Reds_r') # ä½¿ç”¨ç´…è‰²æ¼¸å±¤ï¼Œå¼·èª¿åš´é‡æ€§

plt.title('å‰ 10 å¤§å®¢æˆ¶é›¢é–‹åŸå› ', fontsize=16)
plt.xlabel('äººæ•¸')
plt.ylabel('é›¢é–‹åŸå› ')

# --- é€²éšæŠ€å·§ï¼šåœ¨é•·æ¢åœ–æ—æ¨™ç¤ºäººæ•¸ ---
# enumerate æœƒåŒæ™‚å›å‚³ã€Œç´¢å¼•ä½ç½® (index)ã€å’Œã€Œæ•¸å€¼ (value)ã€
for index, value in enumerate(top_churn_reasons.values):
    # plt.text(xåº§æ¨™, yåº§æ¨™, æ–‡å­—å…§å®¹, å°é½Šæ–¹å¼)
    plt.text(value, index, f' {value}', va='center')

plt.tight_layout()
plt.show()