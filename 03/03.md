# 顧客狀態分析與流失原因：Python 程式碼詳解

本文件詳細拆解了使用 Python (`pandas`, `matplotlib`, `seaborn`)
進行顧客流失分析的完整流程。這份分析針對顧客的三種狀態（Stayed, Churned,
Joined）進行特徵比較，並深入探討已流失客群的具體原因。

------------------------------------------------------------------------

## 步驟 1：環境設定與解決中文亂碼

``` python
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
import platform

sns.set(style="whitegrid")

system_name = platform.system()
if system_name == 'Windows':
    plt.rcParams['font.sans-serif'] = ['Microsoft JhengHei']
elif system_name == 'Darwin':
    plt.rcParams['font.sans-serif'] = ['Arial Unicode MS']
else:
    plt.rcParams['font.sans-serif'] = ['SimHei']

plt.rcParams['axes.unicode_minus'] = False
```

------------------------------------------------------------------------

## 步驟 2：讀取資料

``` python
df = pd.read_csv('customer_data_cleaned.csv')
```

------------------------------------------------------------------------

## 步驟 3：(a) 數值變數比較

``` python
numeric_cols = ['加入期間 (月)', '每月費用', '總費用', '年齡', '總收入']

df_numeric_melted = df.melt(
    id_vars='客戶狀態',
    value_vars=numeric_cols,
    var_name='特徵',
    value_name='數值'
)

plt.figure(figsize=(15, 6))
sns.barplot(
    data=df_numeric_melted,
    x='特徵',
    y='數值',
    hue='客戶狀態',
    errorbar=None,
    palette='viridis'
)
plt.title('各群組數值特徵平均值比較', fontsize=16)
plt.legend(title='客戶狀態')
plt.show()
```

------------------------------------------------------------------------

## 步驟 4：(a) 類別變數分布

``` python
categorical_cols = ['合約類型', '網路連線類型', '優惠方式']

for col in categorical_cols:
    cross_tab = pd.crosstab(df['客戶狀態'], df[col], normalize='index') * 100

    ax = cross_tab.plot(
        kind='bar',
        stacked=True,
        figsize=(10, 6),
        colormap='Set2'
    )

    for c in ax.containers:
        ax.bar_label(c, fmt='%.1f%%', label_type='center', fontsize=10, color='white')

    plt.tight_layout()
    plt.show()
```

------------------------------------------------------------------------

## 步驟 5：(b) 流失大類別

``` python
churned_df = df[df['客戶狀態'] == 'Churned']

churn_category_counts = churned_df['客戶流失類別'].value_counts()

plt.figure(figsize=(8, 8))
plt.pie(
    churn_category_counts,
    labels=churn_category_counts.index,
    autopct='%1.1f%%',
    startangle=140,
    colors=sns.color_palette("pastel")
)
plt.title('客戶流失類別佔比', fontsize=16)
plt.show()
```

------------------------------------------------------------------------

## 步驟 6：(b) 前 10 大離開原因

``` python
top_churn_reasons = churned_df['客戶離開原因'].value_counts().head(10)

plt.figure(figsize=(12, 8))
sns.barplot(
    x=top_churn_reasons.values,
    y=top_churn_reasons.index,
    palette='Reds_r'
)

for index, value in enumerate(top_churn_reasons.values):
    plt.text(value, index, f' {value}', va='center')

plt.tight_layout()
plt.show()
```
